@page "/login"
@using Backend.Domain.Entities.Authentication.Users.Login.Request;
@using System.Text.Json;
@using System.Text;
@using Backend.Domain.Entities.Authentication.Users.UserContext;
@inject HttpClient client

<div class="container" style="margin-top:30px">
<div class="col-md-4">
    <div class="panel panel-default">
  <div class="panel-heading"><h3 class="panel-title"><strong>Sign In </strong></h3></div>
  <div class="panel-body">
   <form role="form">
  <div class="form-group">
    <label for="exampleInputEmail1">Username or Email</label>
    <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Enter email" @bind="@model.Username">
  </div>
  <div class="form-group">
    <label for="exampleInputPassword1">Password </label>
    <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password" @bind="@model.Password">
  </div>
  <button type="button" @onclick="SignIn" class="btn btn-default">Sign in</button>
</form>
  </div>
</div>
</div>
</div>


@code {
    private LoginRequest model = new LoginRequest();

    private async void SignIn(){

        var request = new HttpRequestMessage(HttpMethod.Post, "https://localhost:7299/Authentication/Login");
        request.Content = new StringContent(JsonSerializer.Serialize(model), Encoding.UTF8, "application/json");
        var response = await client.SendAsync(request);

        var aids = await response.Content.ReadFromJsonAsync<UserSessionContext>();

        Console.WriteLine(JsonSerializer.Serialize(aids));
        foreach (var header in response.Headers)
        {
            Console.WriteLine($"{header.Key}={header.Value.First()}");
        }
        //TODO: IMPLEMENT THE COOKIE OF THE AUTHORIZATION OF GETTING THE SESSION BECAUSE LEO IS GAY 
        // READ AS A RUSSIAN

    }
}
